import requests
from bs4 import BeautifulSoup
import json
from datetime import datetime

id_list = [
    (1, 189, "一般女生組100公尺自由式 預賽"),(2, 149, "一般男生組50公尺蛙式 預賽"),(3, 111, "一般女生組50公尺背式 預賽"),(4, 72, "公開男生組400公尺自由式 慢組計時決賽"),(5, 209, "一般女生組100公尺蝶式 預賽"),
    (6, 169, "一般男生組100公尺蝶式 預賽"),(7, 129, "公開女生組100公尺蝶式 預賽"),(8, 91, "公開男生組游泳 100公尺蝶式 預賽"),(9, 195, "一般女生組50公尺蛙式 預賽"),(10, 155, "一般男生組游泳 50公尺蛙式 預賽"),
    (11, 115, "公開女生組游泳 50公尺蛙式 預賽"),(12, 77, "公開男生組游泳 50公尺蛙式 預賽"),(13, 205, "一般女生組200公尺仰式 預賽"),(14, 165, "一般男生組游泳 200公尺仰式 預賽"),(15, 125, "公開女生組游泳 200公尺仰式 預賽"),
    (16, 87, "公開男生組游泳 200公尺仰式 預賽"),(17, 219, "一般女生組4*200公尺自由式接力 預賽"),(18, 179, "一般男生組游泳 4*200公尺自由式接力 預賽"),(19, 139, "公開男女混合組游泳 4*100公尺自由式接力 預賽"),(20, 188, "一般女生組400公尺自由式 快組計時決賽"),
    (21, 148, "一般男生組游泳 400公尺自由式 快組計時決賽"),(22, 110, "公開女生組游泳 400公尺自由式 快組計時決賽"),(23, 71, "公開男生組游泳 400公尺自由式 快組計時決賽"),(24, 208, "一般女生組100公尺蝶式 決賽"),(25, 168, "一般男生組100公尺蝶式 決賽"),
    (26, 128, "公開女生組游泳 100公尺蝶式 決賽"),(27, 90, "公開男生組游泳 100公尺蝶式 決賽"),(28, 194, "一般女生組50公尺蛙式 決賽"),(29, 154, "一般男生組游泳 50公尺蛙式 決賽"),(30, 114, "公開女生組游泳 50公尺蛙式 決賽"),
    (31, 76, "公開男生組游泳 50公尺蛙式 決賽"),(32, 204, "一般女生組200公尺仰式 決賽"),(33, 164, "一般男生組游泳 200公尺仰式 決賽"),(34, 124, "公開女生組游泳 200公尺仰式 決賽"),(35, 86, "公開男生組游泳 200公尺仰式 決賽"),
    (36, 218, "一般女生組4*200公尺自由式接力 決賽"),(37, 178, "一般男生組游泳 4*200公尺自由式接力 決賽"),(38, 138, "公開男女混合組游泳 4*100公尺自由式接力 決賽"),(39, 191, "一般女生組800公尺自由式 慢組計時決賽"),(40, 151, "一般男生組游泳 800公尺自由式 慢組計時決賽"),
    (41, 213, "一般女生組200公尺混合式 預賽"),(42, 173, "一般男生組游泳 200公尺混合式 預賽"),(43, 132, "公開女生組游泳 200公尺混合式 預賽"),(44, 95, "公開男生組游泳 200公尺混合式 預賽"),(45, 185, "一般女生組100公尺自由式 預賽"),
    (46, 145, "一般男生組100公尺自由式 預賽"),(47, 107, "公開女生組游泳 100公尺自由式 預賽"),(48, 68, "公開男生組游泳 100公尺自由式 預賽"),(49, 201, "一般女生組50公尺仰式 預賽"),(50, 161, "一般男生組游泳 50公尺仰式 預賽"),
    (51, 121, "公開女生組游泳 50公尺仰式 預賽"),(52, 83, "公開男生組游泳 50公尺仰式 預賽"),(54, 101, "公開男生組游泳 4*200公尺自由式接力 預賽"),(55, 223, "一般混合組男女4*100公尺自由式接力 預賽"),
    (56, 190, "一般女生組800公尺自由式 快組計時決賽"),(57, 150, "一般男生組游泳 800公尺自由式 快組計時決賽"),(58, 212, "一般女生組200公尺混合式 決賽"),(59, 172, "一般男生組游泳 200公尺混合式 決賽"),(60, 131, "公開女生組游泳 200公尺混合式 決賽"),
    (61, 94, "公開男生組游泳 200公尺混合式 決賽"),(62, 184, "一般女生組100公尺自由式 決賽"),(63, 144, "一般男生組100公尺自由式 決賽"),(64, 106, "公開女生組游泳 100公尺自由式 決賽"),(65, 67, "公開男生組游泳 100公尺自由式 決賽"),
    (66, 200, "一般女生組50公尺仰式 決賽"),(67, 160, "一般男生組游泳 50公尺仰式 決賽"),(68, 120, "公開女生組游泳 50公尺仰式 決賽"),(69, 82, "公開男生組游泳 50公尺仰式 決賽"),(70, 136, "公開女生組游泳 4*200公尺自由式接力 決賽"),
    (71, 100, "公開男生組游泳 4*200公尺自由式接力 決賽"),(72, 222, "一般混合組男女4*100公尺自由式接力 決賽"),(73, 228, "公開女生組游泳 1500公尺自由式 慢組計時決賽"),(74, 226, "公開男生組游泳 1500公尺自由式 慢組計時決賽"),(75, 211, "一般女生組200公尺蝶式 預賽"),
    (76, 171, "一般男生組游泳 200公尺蝶式 預賽"),(78, 93, "公開男生組游泳 200公尺蝶式 預賽"),(79, 203, "一般女生組游泳 100公尺仰式 預賽"),(80, 163, "一般男生組100公尺仰式 預賽"),
    (81, 123, "公開女生組游泳 100公尺仰式 預賽"),(82, 85, "公開男生組游泳 100公尺仰式 預賽"),(83, 197, "一般女生組100公尺蛙式 預賽"),(84, 157, "一般男生組100公尺蛙式 預賽"),(85, 117, "公開女生組游泳 100公尺蛙式 預賽"),
    (86, 79, "公開男生組游泳 100公尺蛙式 預賽"),(87, 217, "一般女生組4*100公尺自由式接力 預賽"),(88, 177, "一般男生組游泳 4*100公尺自由式接力 預賽"),(89, 135, "公開女生組游泳 4*100公尺自由式接力 預賽"),(90, 99, "公開男生組游泳 4*100公尺自由式接力 預賽"),
    (91, 113, "公開女生組游泳 1500公尺自由式 快組計時決賽"),(92, 75, "公開男生組游泳 1500公尺自由式 快組計時決賽"),(93, 210, "一般女生組200公尺蝶式 決賽"),(94, 170, "一般男生組游泳 200公尺蝶式 決賽"),(95, 130, "公開女生組游泳 200公尺蝶式 決賽"),
    (96, 92, "公開男生組游泳 200公尺蝶式 決賽"),(97, 202, "一般女生組游泳 100公尺仰式 決賽"),(98, 162, "一般男生組100公尺仰式 決賽"),(99, 122, "公開女生組游泳 100公尺仰式 決賽"),(100, 84, "公開男生組游泳 100公尺仰式 決賽"),
    (101, 196, "一般女生組100公尺蛙式 決賽"),(102, 156, "一般男生組100公尺蛙式 決賽"),(103, 116, "公開女生組游泳 100公尺蛙式 決賽"),(104, 78, "公開男生組游泳 100公尺蛙式 決賽"),(105, 216, "一般女生組4*100公尺自由式接力 決賽"),
    (106, 176, "一般男生組游泳 4*100公尺自由式接力 決賽"),(107, 134, "公開女生組游泳 4*100公尺自由式接力 決賽"),(108, 98, "公開男生組游泳 4*100公尺自由式接力 決賽"),(109, 193, "一般女生組1500公尺自由式 慢組計時決賽"),(110, 153, "一般男生組1500公尺自由式 慢組計時決賽"),
    (111, 199, "一般女生組200公尺蛙式 預賽"),(112, , "一般男生組游泳 200公尺蛙式 預賽"),(113, , "公開女生組游泳 200公尺蛙式 預賽"),(114, , "公開男生組游泳 200公尺蛙式 預賽"),(115, 183, "一般女生組50公尺自由式 預賽"),
    (116, , "一般男生組游泳 50公尺自由式 預賽"),(117, , "公開女生組游泳 50公尺自由式 預賽"),(118, , "公開男生組游泳 50公尺自由式 預賽"),(119, , "公開女生組游泳 400公尺混合式 慢組計時決賽"),(120, , "公開男生組游泳 400公尺混合式 慢組計時決賽"),
    (121, 187, "一般女生組200公尺自由式 預賽"),(122, , "一般男生組游泳 200公尺自由式 預賽"),(123, , "公開女生組游泳 200公尺自由式 預賽"),(124, , "公開男生組游泳 200公尺自由式 預賽"),(125, 221, "一般女生組4*100公尺混合式接力 預賽"),
    (126, , "一般男生組游泳 4*100公尺混合式接力 預賽"),(127, , "公開男女混合組游泳 4*100公尺混合式接力 預賽"),(128, 192, "一般女生組1500公尺自由式 快組計時決賽"),(129, 152, "一般男生組1500公尺自由式 快組計時決賽"),(130, 198, "一般女生組200公尺蛙式 決賽"),
    (131, , "一般男生組游泳 200公尺蛙式 決賽"),(132, , "公開女生組游泳 200公尺蛙式 決賽"),(133, , "公開男生組游泳 200公尺蛙式 決賽"),(134, 182, "一般女生組50公尺自由式 決賽"),(135, , "一般男生組游泳 50公尺自由式 決賽"),
    (136, , "公開女生組游泳 50公尺自由式 決賽"),(137, , "公開男生組游泳 50公尺自由式 決賽"),(138, , "公開女生組游泳 400公尺混合式 快組計時決賽"),(139, , "公開男生組游泳 400公尺混合式 快組計時決賽"),(140, 186, "一般女生組200公尺自由式 決賽"),
    (141, , "一般男生組游泳 200公尺自由式 決賽"),(142, , "公開女生組游泳 200公尺自由式 決賽"),(143, , "公開男生組游泳 200公尺自由式 決賽"),(144, 220, "一般女生組4*100公尺混合式接力 決賽"),(145, , "一般男生組游泳 4*100公尺混合式接力 決賽"),
    (146, , "公開男女混合組游泳 4*100公尺混合式接力 決賽"),(147, , "公開女生組游泳 800公尺自由式 慢組計時決賽"),(148, , "公開男生組游泳 800公尺自由式 慢組計時決賽"),(149, 207, "一般女生組50公尺蝶式 預賽"),(150, , "一般男生組游泳 50公尺蝶式 預賽"),
    (151, , "公開女生組游泳 50公尺蝶式 預賽"),(152, , "公開男生組游泳 50公尺蝶式 預賽"),(153, 215, "一般女生組400公尺混合式 慢組計時決賽"),(154, , "一般男生組游泳 400公尺混合式 慢組計時決賽"),
    (156, , "公開男生組游泳 4*100公尺混合式接力 預賽"),(157, 225, "一般混合組男女4*100公尺混合式接力 預賽"),(158, , "公開女生組游泳 800公尺自由式 快組計時決賽"),(159, , "公開男生組游泳 800公尺自由式 快組計時決賽"),(160, 206, "一般女生組50公尺蝶式 決賽"),
    (161, , "一般男生組游泳 50公尺蝶式 決賽"),(162, , "公開女生組游泳 50公尺蝶式 決賽"),(163, , "公開男生組游泳 50公尺蝶式 決賽"),(164, 214, "一般女生組400公尺混合式 快組計時決賽"),(165, , "一般男生組游泳 400公尺混合式 快組計時決賽"),
    (166, , "公開女生組游泳 4*100公尺混合式接力 決賽"),(167, , "公開男生組游泳 4*100公尺混合式接力 決賽"),(168, 224, "一般混合組男女4*100公尺混合式接力 決賽"),
    (201, , "公開男生組游泳 400公尺自由式 決賽"),(202, , "公開男生組游泳 800公尺自由式 決賽"),(203, , "公開男生組游泳 1500公尺自由式 決賽"),(204, , "公開男生組游泳 400公尺混合式 決賽"),(205, , "公開女生組游泳 400公尺自由式 決賽"),
    (206, , "公開女生組游泳 800公尺自由式 決賽"),(207, , "公開女生組游泳 1500公尺自由式 決賽"),(208, , "公開女生組游泳 400公尺混合式 決賽"),(209, , "一般男生組游泳 400公尺自由式 決賽"),(210, , "一般男生組游泳 800公尺自由式 決賽"),
    (211, , "一般男生組游泳 1500公尺自由式 決賽"),(212, , "一般男生組游泳 400公尺混合式 決賽"),(213, 669, "一般女生組400公尺自由式 決賽"),(214, 670, "一般女生組800公尺自由式 決賽"),(215, 671, "一般女生組1500公尺自由式 決賽"),
    (216, 672, "一般女生組400公尺混合式 決賽"),
]

def fetch_score(id_):
    url = f"https://114niag.cjcu.edu.tw/Public/Race/Report_Score.aspx?id={id_}"
    print(f"Fetching {url}")
    try:
        headers = {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36"
        }
        res = requests.get(url, headers=headers, timeout=10, verify=False)  # <--- 這裡加 verify=False
        print(f"Status Code: {res.status_code}")
        res.raise_for_status()
    except requests.RequestException as e:
        print(f"Request error: {e}")
        return None

    soup = BeautifulSoup(res.text, 'html.parser')
    table = soup.find('table', id='table1')
    if not table:
        print("No table found.")
        return None

    rows = []
    for tr in table.find_all('tr'):
        cols = [td.get_text(strip=True) for td in tr.find_all(['td', 'th'])]
        if cols:
            rows.append(cols)

    if len(rows) < 2:
        print("Table has no data rows.")
        return None

    headers = rows[0]
    data_rows = rows[1:]

    records = []
    for row in data_rows:
        if len(row) >= len(headers):
            record = dict(zip(headers, row))
            records.append(record)

    return records

def main():
    result = []
    for order, id_, title in id_list:
        scores = fetch_score(id_)
        if scores:
            result.append({
                "order": order,
                "id": id_,
                "title": title,
                "timestamp": datetime.now().isoformat(),
                "scores": scores
            })

    with open('data/score.json', 'w', encoding='utf-8') as f:
        json.dump(result, f, ensure_ascii=False, indent=2)

if __name__ == "__main__":
    main()
